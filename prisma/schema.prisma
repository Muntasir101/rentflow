generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  phone     String?
  role      String // ADMIN, MANAGER, STAFF, TENANT
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenantDetails Tenant?
  assignedTasks ServiceRequest[] @relation("AssignedTo")
}

model Building {
  id        String   @id @default(uuid())
  name      String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  flats Flat[]
}

model Flat {
  id         String   @id @default(uuid())
  number     String
  buildingId String
  rentAmount Float
  isOccupied Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  building Building @relation(fields: [buildingId], references: [id])
  tenants  Tenant[]
}

model Tenant {
  id               String    @id @default(uuid())
  userId           String    @unique
  flatId           String?
  moveInDate       DateTime
  moveOutDate      DateTime? // Retained as per original, not explicitly removed by instruction
  securityDeposit  Float
  photo            String? // Base64 encoded photo or file path
  identityDocument String? // Base64 encoded document or file path
  identityType     String? // NID, Passport, Driving License, etc.
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  user            User             @relation(fields: [userId], references: [id])
  flat            Flat?            @relation(fields: [flatId], references: [id])
  payments        Payment[]
  utilityBills    UtilityBill[]
  serviceRequests ServiceRequest[]
  familyMembers   FamilyMember[]
}

model FamilyMember {
  id           String   @id @default(uuid())
  tenantId     String
  name         String
  relationship String // e.g., Spouse, Child, Parent, Sibling
  age          Int?
  phone        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Payment {
  id        String   @id @default(uuid())
  tenantId  String
  amount    Float
  date      DateTime @default(now())
  type      String // RENT, UTILITY, DEPOSIT
  method    String // CASH, BANK, BKASH, NAGAD
  status    String // PAID, PARTIAL, PENDING
  month     String? // e.g., "2023-10"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
}

model UtilityBill {
  id        String   @id @default(uuid())
  tenantId  String
  type      String // ELECTRICITY, WATER, GAS, INTERNET, SERVICE
  amount    Float
  month     String // e.g., "2023-10"
  isPaid    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
}

model ServiceRequest {
  id           String   @id @default(uuid())
  tenantId     String
  assignedToId String?
  category     String // PLUMBING, ELECTRICAL, CLEANING, OTHER
  description  String
  status       String // PENDING, IN_PROGRESS, COMPLETED
  cost         Float?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenant     Tenant @relation(fields: [tenantId], references: [id])
  assignedTo User?  @relation("AssignedTo", fields: [assignedToId], references: [id])
}
